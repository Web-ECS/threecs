<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>threecs | Examples: Simple Character Controller</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <script type="module">
      import {
        Object3D,
        Mesh,
        BoxBufferGeometry,
        MeshBasicMaterial,
        Vector3,
        TextureLoader,
      } from "three";
      import {
        ActionType,
        createThreeWorld,
        addObject3DEntity,
        addComponent,
        BindingType,
        FirstPersonCameraSystem,
        FirstPersonCameraActions,
        FirstPersonCameraYawTarget,
        FirstPersonCameraPitchTarget,
        DirectionalMovementSystem,
        DirectionalMovementActions,
        DirectionalMovementComponent,
      } from "../src/threecs";
      import crateTextureUrl from "./assets/crate.gif";

      const { world, scene, camera, cameraEid, start } = createThreeWorld({
        pointerLock: true,
        systems: [FirstPersonCameraSystem, DirectionalMovementSystem],
        actionMaps: [
          {
            id: "movement",
            actions: [
              {
                id: "look",
                path: FirstPersonCameraActions.Look,
                type: ActionType.Vector2,
                bindings: [
                  {
                    type: BindingType.Axes,
                    x: "Mouse/movementX",
                    y: "Mouse/movementY",
                  },
                ],
              },
              {
                id: "move",
                path: DirectionalMovementActions.Move,
                type: ActionType.Vector2,
                bindings: [
                  {
                    type: BindingType.DirectionalButtons,
                    up: "Keyboard/w",
                    down: "Keyboard/s",
                    left: "Keyboard/a",
                    right: "Keyboard/d",
                  },
                ],
              },
            ],
          },
        ],
      });

      const playerRig = new Object3D();
      const playerRigEid = addObject3DEntity(world, playerRig, scene);
      addComponent(world, DirectionalMovementComponent, playerRigEid);
      addComponent(world, FirstPersonCameraYawTarget, playerRigEid);
      playerRig.add(camera);
      addComponent(world, FirstPersonCameraPitchTarget, cameraEid);

      playerRig.position.z = 5;

      const crateTexture = new TextureLoader().load(crateTextureUrl);
      const cube = new Mesh(
        new BoxBufferGeometry(),
        new MeshBasicMaterial({ map: crateTexture })
      );
      const cubeEid = addObject3DEntity(world, cube, scene);

      start();
    </script>
  </body>
</html>
