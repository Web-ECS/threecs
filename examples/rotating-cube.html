<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>threecs | Examples: Rotating Cube</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <script type="module">
      import { defineQuery, defineSystem, defineComponent } from "bitecs";
      import {
        Mesh,
        BoxBufferGeometry,
        MeshBasicMaterial,
        Vector3,
        TextureLoader,
      } from "three";
      import { bootstrapThreeWorld, Object3DComponent } from "../src/threecs";
      import crateTextureUrl from "./assets/crate.gif";

      const RotateComponent = defineComponent(new Map());

      const rotateQuery = defineQuery([RotateComponent, Object3DComponent]);

      const RotateSystem = defineSystem((world) => {
        const entities = rotateQuery(world);

        entities.forEach((eid) => {
          const dt = world.dt;
          const object3D = Object3DComponent.get(eid);
          const { speed, axis } = RotateComponent.get(eid);
          object3D.rotateOnAxis(axis, speed * dt);
        });
      });

      const crateTexture = new TextureLoader().load(crateTextureUrl);

      bootstrapThreeWorld({
        beforeRenderSystems: [RotateSystem],
        entities: [
          {
            target: "scene",
            children: [
              {
                target: "camera",
                position: new Vector3(0, 0, 5),
              },
              {
                object3D: new Mesh(
                  new BoxBufferGeometry(),
                  new MeshBasicMaterial({ map: crateTexture })
                ),
                components: [
                  [
                    RotateComponent,
                    { axis: new Vector3(0.5, 1, 0).normalize(), speed: 1 },
                  ],
                ],
              },
            ],
          },
        ],
      });
    </script>
  </body>
</html>
