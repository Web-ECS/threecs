<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>threecs | Examples: Rotating Cube</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <script type="module">
      import {
        Mesh,
        BoxBufferGeometry,
        MeshBasicMaterial,
        Vector3,
        TextureLoader,
      } from "three";
      import {
        defineQuery,
        defineSystem,
        createThreeWorld,
        Object3DComponent,
        addObject3DEntity,
        addMapComponent,
        defineMapComponent,
        createMeshEntity,
      } from "../src/threecs";
      import {
        MeshProxy
      } from '../src/core/MeshProxy'
      import {
        setQuaternionFromEulerAoA,
        // MeshProxy,
      } from '@webecs/do-three'
      import crateTextureUrl from "./assets/crate.gif";

      const RotateComponent = defineMapComponent();

      const rotateQuery = defineQuery([RotateComponent, Object3DComponent]);

      const RotateSystem = defineSystem((world) => {
        const entities = rotateQuery(world);

        entities.forEach((eid) => {
          const dt = world.dt;
          // Object3DComponent.rotation[eid][0] += 0.005
          // setQuaternionFromEulerAoA(Object3DComponent.quaternion[eid], Object3DComponent.rotation[eid])
          // const object3D = Object3DComponent.storage.get(eid);
          // const { speed, axis } = RotateComponent.storage.get(eid);
          // object3D.rotateOnAxis(axis, speed * dt);
        });
      });

      const { world, scene, camera, start } = createThreeWorld({
        systems: [RotateSystem],
      });

      camera.position.z = 5;

      const crateTexture = new TextureLoader().load(crateTextureUrl);
      // const cube = new Mesh(
      //   new BoxBufferGeometry(),
      //   new MeshBasicMaterial({ map: crateTexture })
      // );

      const cube = new MeshProxy(
        Object3DComponent,
        0,
        new BoxBufferGeometry(),
        new MeshBasicMaterial({ wireframe: true })
      );

      // const cube = createMeshEntity(
      //   world,
      //   new BoxBufferGeometry(),
      //   new MeshBasicMaterial({ wireframe: true })
      // )
      scene.add(cube)
      // const cubeEid = addObject3DEntity(world, cube, scene);
      // addMapComponent(world, RotateComponent, cubeEid, {
      //   axis: new Vector3(0.5, 1, 0).normalize(),
      //   speed: 1,
      // });

      start();
    </script>
  </body>
</html>
